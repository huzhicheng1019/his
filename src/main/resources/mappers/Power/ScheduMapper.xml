<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.gson.his.model.mappers.Power.ScheduMapper">
    <select id="allDeptId" resultType="java.lang.Integer">
        select dept_id from dept where dept_name=#{name}
    </select>

    <!--映射科室-->
    <resultMap id="depa" type="cn.gson.his.model.pojos.Power.Department">
        <id property="depaId" column="DEPA_ID"></id>
        <result property="depaName" column="DEPA_NAME"></result>
        <result property="depaCreate" column="DEPA_CREATE"></result>
    </resultMap>
    <select id="deptIdDepa" resultMap="depa">
        select * from DEPARTMENT where DEPA_DEPT=#{id}
    </select>

    <!--映射职称-->
    <resultMap id="Tit" type="cn.gson.his.model.pojos.Power.Title">
        <id property="titId" column="TIT_ID"/>
        <result property="titName" column="TIT_NAME"/>
    </resultMap>
    <select id="deptIdTit" resultMap="Tit">
        select * from TITLE where TIT_DEPT=#{id}
    </select>

    <resultMap id="EmpMap" type="cn.gson.his.model.pojos.Power.Employee">
        <id property="empId" column="emp_id"></id>
        <result property="empName" column="emp_name"></result>
        <result property="empPhone" column="emp_phone"></result>
        <result property="empCard" column="emp_card"></result>
        <result property="empInduction" column="emp_induction"></result>
        <result property="empDeparture" column="emp_departure"></result>
        <result property="empState" column="emp_state"></result>
        <!--部门-->
        <association property="deptByEmpDept" javaType="cn.gson.his.model.pojos.Power.Dept">
            <id property="deptId" column="dept_id"></id>
            <result property="deptName" column="dept_name"></result>
        </association>
        <!--科室-->
        <association property="departmentByEmpDepar" javaType="cn.gson.his.model.pojos.Power.Department">
            <id property="depaId" column="depa_id"></id>
            <result property="depaName" column="depa_name"></result>
        </association>
        <!--职称-->
        <association property="titles" javaType="cn.gson.his.model.pojos.Power.Title">
            <id property="titId" column="tit_id"></id>
            <result property="titName" column="tit_name"></result>
        </association>
    </resultMap>
    <select id="depaIdByEmp" resultMap="EmpMap">
        SELECT * FROM EMPLOYEE e left join title t on e.emp_tit = t.tit_id where e.EMP_DEPT=#{dept} and e.EMP_DEPAR=#{depa}
    </select>

    <resultMap id="Shift" type="cn.gson.his.model.pojos.Power.Shift">
        <id property="shiId" column="SHI_ID"/>
        <result property="shiName" column="SHI_NAME"/>
        <result property="startTime" column="START_TIME"/>
        <result property="stopTime" column="STOP_TIME"/>
    </resultMap>
    <select id="allShift" resultMap="Shift">
        SELECT * FROM SHIFT
    </select>


    <!--批量新增排班-->
    <insert id="addSchedu" parameterType="java.util.List">
        insert into schedu(SCHE_ID, EMP_ID, SCHE_DATE,START_TIME,STOP_TIME)
        select seq.nextval, EMP_ID, SCHE_DATE,START_TIME,STOP_TIME from
        <foreach collection="list" item="p" index="i" separator=" " open="(" close=")">
            <if test="i != list.size()-1">
                select #{p.emp.empId} as EMP_ID , #{p.scheDate} as SCHE_DATE,#{p.startTime} as START_TIME,#{p.stopTime} as STOP_TIME from dual
                union
            </if>
            <if test="i == list.size()-1">
                select #{p.emp.empId} as EMP_ID , #{p.scheDate} as SCHE_DATE,#{p.startTime} as START_TIME,#{p.stopTime} as STOP_TIME from dual
            </if>
        </foreach>
    </insert>
</mapper>