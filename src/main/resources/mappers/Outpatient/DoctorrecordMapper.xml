<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.gson.his.model.mappers.Outpatient.DoctorrecordMapper">
<!--    查询的结果级映射-->
<resultMap id="Doctorrecord" type="cn.gson.his.model.pojos.Outpatient.DoctorrecordEntity">
    <id column="RECORD_NO" property="recordNo"/>
    <result column="RECORD_IDENTITY" property="recordIdentity"/>
    <result column="RECORD_NAME" property="recordName"/>
    <result column="RECORD_PHONE" property="recordPhone"/>
    <result column="DOCTOR_NAME" property="doctorName"/>
    <result column="RECORD_INDOOR" property="recordIndoor"/>
    <result column="RECORD_RECORD" property="recordRecord"/>
<!--    主治医生-->
    <association property="doctor" javaType="cn.gson.his.model.pojos.Power.Employee">
        <id property="empId" column="EMP_ID"></id>
        <result property="empName" column="EMP_NAME"></result>
    </association>
<!--    就诊卡-->
    <association property="card" javaType="cn.gson.his.model.pojos.Outpatient.CardEntity">
        <id column="CARD_ID" property="cardId"/>
        <result column="CARD_NO" property="cardNo"/>
        <result column="CARD_PSWD" property="cardPswd"/>
        <result column="CARD_PRICE" property="cardPrice"/>
        <result column="CARD_PREPAY" property="cardPrepay"/>
        <result column="PATIENT_NAME" property="patientName"/>
        <result column="CARD_STATE" property="cardState"/>
    </association>
<!--    患者信息-->
    <association property="patient" javaType="cn.gson.his.model.pojos.Outpatient.PatientdataEntity">
        <id column="PATIENT_NO" property="patientNo"></id>
        <result column="PATIENT_NAME" property="patientName"/>
        <result column="PATIENT_SEX" property="patientSex"/>
        <result column="PATIENT_AGE" property="patientAge"/>
        <result column="PATIENT_PHONE" property="patientPhone"/>
        <result column="PATIENT_INSU" property="patientInsu"/>
        <result column="PATIENT_IDENTITY" property="patientIdentity"/>
        <result column="PATIENT_PIRTH" property="patientPirth"/>
    </association>
<!-- 病历-->
    <association property="caseHissstory" javaType="cn.gson.his.model.pojos.Outpatient.CaseHistoryEntity">
        <id column="CASE_HISSSTORY" property="caseHissstory"/>
        <result column="PATIENT_NAME" property="patientName"/>
        <result column="PATIENT_IDENTITY" property="patientIdentity"/>
        <result column="PATIENT_NO" property="patientNo"/>
    </association>
</resultMap>
<!--  查询就诊记录-->
    <select id="allDoctorrecord" resultMap="Doctorrecord">
        select * from DOCTORRECORD d inner join PATIENTDATA P on d.PATIENT_NO = P.PATIENT_NO
        inner join CARD C2 on d.CARD_ID = C2.CARD_ID
        inner join EMPLOYEE E on E.EMP_ID = d.DOCTOR_NO
        inner join DEPARTMENT D2 on D2.DEPA_ID = d.RECORD_INDOOR
        inner join CASE_HISTORY C1 on C1.CASE_HISSSTORY = d.CASE_HISSSTORY
        <where>
            1=1
            <if test="patient.patientName !=null">
                P.PATIENT_NAME = #{patient.patientName}
            </if>
            <if test="patient.patientIdentity !=null">
                and P.PATIENT_IDENTITY = #{patient.patientIdentity}
            </if>
            <if test="recordNo != null">
                and D.RECORD_NO = #{recordNo}
            </if>
        </where>
    </select>

</mapper>